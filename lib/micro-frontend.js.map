{"version":3,"file":"micro-frontend.js","sources":["../src/application/state.js","../src/start.js","../src/utils.js","../src/application/timeout.js","../src/lifecyle/load.js","../src/lifecyle/unmount.js","../src/lifecyle/mount.js","../src/lifecyle/bootstrap.js","../src/navigation/invoke.js","../src/application/app.js"],"sourcesContent":["export const NOT_LOADED = \"NOT_LOADED\"\nexport const LOAD_SOURCE_CODE = 'LOAD_SOURCE_CODE'\nexport const NOT_BOOTSTRAPED = 'NOT_BOOTSTRAPED'\nexport const BOOTSTRAPING = 'BOOTSTRAPING'\nexport const NOT_MOUNTED = 'NOT_MOUNTED'\nexport const MOUNTING = 'MOUNTING'\nexport const MOUNTED = 'MOUNTED'\nexport const UNMOUNTING = 'UNMOUNTING'\n\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN'\nexport const LOAD_ERROR = 'LOAD_ERROR'\n\n\n\nexport function noSkip(app) {\n    return app.status !== SKIP_BECAUSE_BROKEN;\n}\n\nexport function noLoadError(app) {\n    return app.status !== LOAD_ERROR\n}\n\nexport function isntLoaded(app) {\n    return !isLoaded(app)\n}\n\nexport function isLoaded(app) {\n    return app.status !== NOT_LOADED && app.status !== LOAD_ERROR\n}\n\nexport function shouldBeActivity(app) {\n    try {\n        return app.activityWhen(window.location)\n    } catch (error) {\n        app.status = SKIP_BECAUSE_BROKEN\n        throw error;\n    }\n}\n\nexport function isActive(app) {\n    return app.status === MOUNTED\n}\n\nexport function isntActive(app) {\n    return !isActive(app)\n}\n\nexport function shouldntBeActive(app) {\n    try {\n        return !app.activityWhen(window.location)\n    } catch (error) {\n        app.status = SKIP_BECAUSE_BROKEN\n        throw error;\n    }\n}","import { invoke } from \"./navigation/invoke\"\n\nlet started = false\n\n\nexport function start() {\n    started = true\n    return invoke()\n}\n\nexport function isStarted() {\n    return started\n}","\nexport const isArray = Array.isArray\n\nexport const isPromise = (promise) => {\n    if (promise instanceof Promise) {\n        return true\n    }\n\n    return typeof promise === 'object' && typeof promise.then === 'function';\n}\n\nexport function flattenPromiseArray(promises) {\n    if (!isArray(promises)) {\n        promises = [promises]\n    }\n    if (promises.length === 0) {\n        promises = [() => Promise.resolve()];\n    }\n    return function (props) {\n        return new Promise((resolve, reject) => {\n            waitForPromises(0)\n            function waitForPromises(index) {\n                let fn = promises[index](props);\n                fn.then(() => {\n                    if (index >= promises.length - 1) {\n                        resolve()\n                    } else {\n                        waitForPromises(++index)\n                    }\n                }).catch(reject)\n            }\n        })\n\n    }\n}","/**\n * promise 队列超时响应\n */\n\nconst DEFAULT_TIMEOUT = {\n    bootstrap: {\n        milliseconds: 3000,\n        rejectwhenTimeout: false\n    },\n    mount: {\n        milliseconds: 3000,\n        rejectwhenTimeout: false,\n    },\n    unmount: {\n        milliseconds: 3000,\n        rejectwhenTimeout: false\n    },\n    unload: {\n        milliseconds: 3000,\n        rejectwhenTimeout:false\n    }\n}\n\nexport function ensureAppTimeouts(timeouts) {\n    return {\n        ...DEFAULT_TIMEOUT,\n        ...timeouts\n    }\n}\n\n\nexport function reasonableTime(promise, timeouts) {\n\n    return new Promise((resolve, reject) => {\n        let finished = false;\n        promise.then(data => {\n            finished = true;\n            resolve(data);\n        }).catch(e => {\n            finished = true;\n            reject(e);\n        });\n\n        setTimeout(() => maybeTimeout(), timeouts.milliseconds)\n        function maybeTimeout() {\n            if (finished) {\n                return;\n            }\n            let error = `${description} did not resolve or reject for ${timeouts.milliseconds} milliseconds`;\n            if (timeouts.rejectWhenTimeout) {\n                reject(new Error(error));\n            } else {\n                console.warn(error);\n            }\n        }\n    })\n}","import { NOT_LOADED, SKIP_BECAUSE_BROKEN, LOAD_SOURCE_CODE, NOT_BOOTSTRAPED, LOAD_ERROR } from \"../application/state\";\nimport { isPromise, flattenPromiseArray } from \"../utils\";\nimport { getProps } from \"../application/app\";\nimport { ensureAppTimeouts } from \"../application/timeout\";\n\nconst lifecyleHooks = ['bootstrap', 'mount', 'unmount']\n\n\n\nexport function toLoadPromise(app) {\n    if (app.status !== NOT_LOADED) {\n        return Promise.resolve(app)\n    }\n    // 下载代码阶段\n    app.status = LOAD_SOURCE_CODE;\n    const loadPromise = app.loadApp(getProps(app))\n    \n    if (!isPromise(loadPromise)) {\n        app.status = SKIP_BECAUSE_BROKEN\n        return Promise.reject(new Error('loadApp is not a Promise'));\n    }\n    const errors = []\n    return loadPromise.then(appConfig => {\n        lifecyleHooks.forEach(lifecyle => {\n            if (!appConfig[lifecyle]) {\n                errors.push(`lifecyle: ${lifecyle} is not exist`)\n            }\n        })\n\n        if (errors.length) {\n            app.status === SKIP_BECAUSE_BROKEN\n            throw new Error(errors)\n        }\n\n        app.status = NOT_BOOTSTRAPED;\n        app.bootstrap = flattenPromiseArray(appConfig.bootstrap);\n        app.mount = flattenPromiseArray(appConfig.mount);\n        app.unmont = flattenPromiseArray(appConfig.unmount);\n\n        app.timeouts= ensureAppTimeouts(appConfig.timeouts)\n\n        return app;\n    }).catch(error=>{\n        console.log(error)\n        app.status = LOAD_ERROR\n        return  app\n    })\n}","import { MOUNTED, UNMOUNTING, SKIP_BECAUSE_BROKEN, NOT_MOUNTED } from \"../application/state\";\nimport { reasonableTime } from \"../application/timeout\";\nimport { getProps } from \"../application/app\";\n\nexport function toUnmountPromise(app) {\n    if (app.status !== MOUNTED) {\n        return Promise.resolve(app)\n    }\n    app.status = UNMOUNTING\n    return reasonableTime(app.unmount(getProps(app)), app.timeouts.unmount).then(() => {\n        app.status = NOT_MOUNTED\n    }).catch(error => {\n        app.status = SKIP_BECAUSE_BROKEN;\n        throw error\n    })\n\n}","import { NOT_MOUNTED, MOUNTING, SKIP_BECAUSE_BROKEN, MOUNTED } from \"../application/state\";\nimport { reasonableTime } from \"../application/timeout\";\nimport { getProps } from \"../application/app\";\nimport { toUnmountPromise } from \"./unmount\";\n\n\nexport function toMountPromise(app) {\n\n    if (app.status !== NOT_MOUNTED) {\n        return Promise.resolve(app)\n    }\n    app.status = MOUNTING\n\n    return reasonableTime(app.mount(getProps(app)), app.timeout.mount).then(() => {\n        app.status = MOUNTED\n        return app\n    }).catch(error => {\n        app.status = MOUNTED\n        // 如果挂在失败  立即执行unmount\n        return toUnmountPromise(app)\n        .catch(()=>{\n            console.log(error)\n        }).then(() => {\n            app.status = SKIP_BECAUSE_BROKEN\n            return app\n        })\n    })\n\n}","import { NOT_BOOTSTRAPED, BOOTSTRAPING, SKIP_BECAUSE_BROKEN,NOT_MOUNTED } from \"../application/state\";\nimport { reasonableTime } from \"../application/timeout\";\nimport { getProps } from \"../application/app\";\n\nexport function toBootstrapPromise(app) {\n    if (app.status !== NOT_BOOTSTRAPED) {\n        return Promise.resolve(app)\n    }\n    app.status = BOOTSTRAPING\n    return reasonableTime(app.bootstrap(getProps(app)), app.timeouts.bootstrap).then(() => {\n        app.status = NOT_MOUNTED\n        return app\n    }).catch(error=>{\n        console.log(error   )\n        app.status =SKIP_BECAUSE_BROKEN\n        throw error;\n    })\n\n}","import { isStarted } from \"../start\"\nimport { getAppsToLoad, getAppsToUnmount, getAppsToMount, getMountedApps } from \"../application/app\"\nimport { toLoadPromise } from '../lifecyle/load'\nimport { toMountPromise } from \"../lifecyle/mount\"\nimport { toBootstrapPromise } from \"../lifecyle/bootstrap\"\nimport { toUnmountPromise } from '../lifecyle/unmount'\n\n\n\nlet appChangeUnderway = false\nlet changesQueue = []\n\nexport function invoke(pendings = []) {\n    if (appChangeUnderway) {\n        return new Promise((resolve, reject) => {\n            changesQueue.push({\n                success: resolve,\n                failure: reject\n            })\n        })\n    }\n    appChangeUnderway = true\n    if (isStarted()) {\n        return performAppsChanged()\n    }\n    return loadApps()\n\n\n\n    function loadApps() {\n        const loadPromises = getAppsToLoad().map(toLoadPromise)\n        Promise.all(loadPromises).then(() => {\n            return finish()\n        })\n    }\n\n    function performAppsChanged() {\n        //unmount\n        const unmountApps = getAppsToUnmount()\n        const unmountPromise = Promise.all(unmountApps.map(toUnmountPromise))\n\n        // load\n        const loadApps = getAppsToLoad()\n        const loadPromises = loadApps.map(app => {\n            return toLoadPromise(app)\n                .then(toBootstrapPromise)\n                .then(() => unmountPromise)\n                .then(toMountPromise)\n        })\n\n        // mount app\n        let mountApps = getAppsToMount().filter(app => loadApps.indexOf(app) === -1);\n        const mountPromises = mountApps.map(app => {\n            return toBootstrapPromise(app)\n                .then(() => unmountPromise)\n                .then(toMountPromise)\n        })\n\n\n        unmountPromise.then(() => {\n            let loadAndMountPromises = loadPromises.concat(mountPromises);\n            return Promise.all(loadAndMountPromises).then(finish, ex => {\n                pendings.forEach(item => item.reject(ex));\n                throw ex;\n            });\n        })\n    }\n\n    function finish() {\n        let resolveValue = getMountedApps()\n        if (pendings.length) {\n            pendings.forEach(item => item.success(resolveValue))\n        }\n\n        appChangeUnderway = false\n        if (changesQueue.length) {\n            let backup = changesQueue;\n            changesQueue = []\n            return invoke(backup)\n        }\n\n        return resolveValue\n    }\n}","import {\n    NOT_LOADED,\n    noSkip,\n    noLoadError,\n    isntLoaded,\n    shouldBeActivity,\n    isActive,\n    shouldntBeActive,\n    isLoaded,\n    isntActive\n} from './state'\nimport { invoke } from '../navigation/invoke'\n\nconst APPS = []\n\nexport function registerApplication(appName, applicationOrLoadFunction, activityWhen, customProps) {\n    if (typeof applicationOrLoadFunction !== 'function') {\n        applicationOrLoadFunction = () => Promise.resolve(applicationOrLoadFunction)\n    }\n\n    APPS.push({\n        name: appName,\n        loadApp: applicationOrLoadFunction,\n        activityWhen,\n        status: NOT_LOADED,\n        customProps\n    })\n\n    return invoke()\n}\n\n\nexport function getAppsToLoad() {\n    return APPS.filter(noSkip)\n        .filter(noLoadError)\n        .filter(isntLoaded)\n        .filter(shouldBeActivity)\n}\n\nexport function getAppsToUnmount() {\n    return APPS.filter(noSkip)\n        .filter(isActive)\n        .filter(shouldntBeActive)\n}\n\n\nexport function getAppsToMount() {\n    return APPS.filter(noSkip)\n        .filter(isLoaded)\n        .filter(isntActive)\n        .filter(shouldBeActivity)\n}\n\n\nexport function getMountedApps(){\n    return APPS.filter(isActive).map(item => item.name);\n}\n\n\nexport function getProps(app) {\n    return {\n        name: app.name,\n        ...app.customProps\n    }\n}\n\n"],"names":["NOT_LOADED","LOAD_SOURCE_CODE","NOT_BOOTSTRAPED","BOOTSTRAPING","NOT_MOUNTED","MOUNTING","MOUNTED","UNMOUNTING","SKIP_BECAUSE_BROKEN","LOAD_ERROR","noSkip","app","status","noLoadError","isntLoaded","isLoaded","shouldBeActivity","activityWhen","window","location","error","isActive","isntActive","shouldntBeActive","started","start","invoke","isStarted","isArray","Array","isPromise","promise","Promise","then","flattenPromiseArray","promises","length","resolve","props","reject","waitForPromises","index","fn","catch","DEFAULT_TIMEOUT","bootstrap","milliseconds","rejectwhenTimeout","mount","unmount","unload","ensureAppTimeouts","timeouts","reasonableTime","finished","data","e","setTimeout","maybeTimeout","description","rejectWhenTimeout","Error","console","warn","lifecyleHooks","toLoadPromise","loadPromise","loadApp","getProps","errors","appConfig","forEach","lifecyle","push","unmont","log","toUnmountPromise","toMountPromise","timeout","toBootstrapPromise","appChangeUnderway","changesQueue","pendings","success","failure","performAppsChanged","loadApps","loadPromises","getAppsToLoad","map","all","finish","unmountApps","getAppsToUnmount","unmountPromise","mountApps","getAppsToMount","filter","indexOf","mountPromises","loadAndMountPromises","concat","ex","item","resolveValue","getMountedApps","backup","APPS","registerApplication","appName","applicationOrLoadFunction","customProps","name"],"mappings":"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"}